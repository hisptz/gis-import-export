/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import * as fromConstants from '../constants';
import { BehaviorSubject, Observable, forkJoin } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class MenuService {
    /**
     * @param {?} httpClient
     */
    constructor(httpClient) {
        this.httpClient = httpClient;
        this._menuModules$ = new BehaviorSubject([]);
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getSystemSettings(rootUrl) {
        return Observable.create(observer => {
            forkJoin(this.httpClient.get(rootUrl + 'api/systemSettings.json'), this.httpClient.get(rootUrl + 'api/system/info.json')).subscribe((settings) => {
                observer.next(Object.assign({}, settings[0], settings[1]));
                observer.complete();
            }, () => observer.error(null));
        });
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getMenuModules(rootUrl) {
        return Observable.create(observer => {
            this.httpClient.get(rootUrl + 'dhis-web-commons/menu/getModules.action').subscribe((menuModuleResult) => {
                const /** @type {?} */ sanitizedMenu = this._sanitizeMenuItems(menuModuleResult.modules, rootUrl);
                this._menuModules$.next(sanitizedMenu);
                observer.next(sanitizedMenu);
                observer.complete();
            }, () => {
                observer.next(null);
                observer.complete();
            });
        });
    }
    /**
     * @return {?}
     */
    getSanitizedMenus() {
        return this._menuModules$.asObservable();
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    getUserInfo(rootUrl) {
        return Observable.create(observer => {
            this.httpClient.get(rootUrl + 'api/me.json').subscribe((userInfo) => {
                observer.next(userInfo);
                observer.complete();
            }, () => {
                observer.next(null);
                observer.complete();
            });
        });
    }
    /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    _sanitizeMenuItems(menuItems, rootUrl) {
        const /** @type {?} */ sanitizedMenuItems = menuItems.map((item) => {
            const /** @type {?} */ newItem = Object.assign({}, item);
            if (!newItem.hasOwnProperty('displayName') ||
                newItem.displayName === '') {
                newItem.displayName = newItem.name;
            }
            if (newItem.defaultAction.indexOf('http') === -1) {
                newItem.defaultAction = '../../' + newItem.defaultAction;
            }
            if (newItem.icon.indexOf('http') === -1) {
                newItem.icon = '../../' + newItem.icon;
            }
            newItem.onlyShowOnSearch = false;
            return newItem;
        });
        const /** @type {?} */ predefinedMenuItems = fromConstants.PREDEFINED_MENU_ITEMS.map((item) => {
            const /** @type {?} */ newItem = Object.assign({}, item);
            if (newItem.defaultAction) {
                newItem.defaultAction = rootUrl + newItem.defaultAction;
            }
            if (newItem.icon) {
                newItem.icon = rootUrl + newItem.icon;
            }
            return newItem;
        });
        return [...sanitizedMenuItems, ...predefinedMenuItems];
    }
}
MenuService.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] },
];
/** @nocollapse */
MenuService.ctorParameters = () => [
    { type: HttpClient }
];
/** @nocollapse */ MenuService.ngInjectableDef = i0.defineInjectable({ factory: function MenuService_Factory() { return new MenuService(i0.inject(i1.HttpClient)); }, token: MenuService, providedIn: "root" });
function MenuService_tsickle_Closure_declarations() {
    /** @type {?} */
    MenuService.prototype._menuModules$;
    /** @type {?} */
    MenuService.prototype.httpClient;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhpc3B0ei9uZ3gtZGhpczItbWVudS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9tZW51LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sS0FBSyxhQUFhLE1BQU0sY0FBYyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7O0FBRzdELE1BQU07Ozs7SUFHSixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZOzZCQUZNLElBQUksZUFBZSxDQUFRLEVBQUUsQ0FBQztLQUc3RTs7Ozs7SUFFRCxpQkFBaUIsQ0FBQyxPQUFlO1FBQy9CLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ2xDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcseUJBQXlCLENBQUMsRUFDL0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsT0FBTyxHQUFHLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ2hFLENBQUMsUUFBZSxFQUFFLEVBQUU7Z0JBQ2xCLFFBQVEsQ0FBQyxJQUFJLG1CQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztnQkFDaEQsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3JCLEVBQ0QsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FDM0IsQ0FBQztTQUNILENBQUMsQ0FBQztLQUNKOzs7OztJQUVELGNBQWMsQ0FBQyxPQUFlO1FB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LEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQzthQUN6RDtZQUVELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixPQUFPLENBQUMsSUFBSSxHQUFHLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2FBQ3ZDO1lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQztTQUNoQixDQUNGLENBQUM7UUFDRixNQUFNLENBQUMsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLEdBQUcsbUJBQW1CLENBQUMsQ0FBQzs7OztZQS9GMUQsVUFBVSxTQUFDLEVBQUMsVUFBVSxFQUFFLE1BQU0sRUFBQzs7OztZQUx2QixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIGZyb21Db25zdGFudHMgZnJvbSAnLi4vY29uc3RhbnRzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcblxuQEluamVjdGFibGUoe3Byb3ZpZGVkSW46ICdyb290J30pXG5leHBvcnQgY2xhc3MgTWVudVNlcnZpY2Uge1xuICBwcml2YXRlIF9tZW51TW9kdWxlcyQ6IEJlaGF2aW9yU3ViamVjdDxhbnlbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueVtdPihbXSk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XG4gIH1cblxuICBnZXRTeXN0ZW1TZXR0aW5ncyhyb290VXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZShvYnNlcnZlciA9PiB7XG4gICAgICBmb3JrSm9pbih0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnYXBpL3N5c3RlbVNldHRpbmdzLmpzb24nKSxcbiAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgJ2FwaS9zeXN0ZW0vaW5mby5qc29uJykpLnN1YnNjcmliZShcbiAgICAgICAgKHNldHRpbmdzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQoey4uLnNldHRpbmdzWzBdLCAuLi5zZXR0aW5nc1sxXX0pO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IG9ic2VydmVyLmVycm9yKG51bGwpXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0TWVudU1vZHVsZXMocm9vdFVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgJ2RoaXMtd2ViLWNvbW1vbnMvbWVudS9nZXRNb2R1bGVzLmFjdGlvbicpLnN1YnNjcmliZShcbiAgICAgICAgKG1lbnVNb2R1bGVSZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNhbml0aXplZE1lbnUgPSB0aGlzLl9zYW5pdGl6ZU1lbnVJdGVtcyhtZW51TW9kdWxlUmVzdWx0Lm1vZHVsZXMsIHJvb3RVcmwpO1xuICAgICAgICAgIHRoaXMuX21lbnVNb2R1bGVzJC5uZXh0KHNhbml0aXplZE1lbnUpO1xuICAgICAgICAgIG9ic2VydmVyLm5leHQoXG4gICAgICAgICAgICBzYW5pdGl6ZWRNZW51XG4gICAgICAgICAgKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9LFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dChudWxsKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0U2FuaXRpemVkTWVudXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lbnVNb2R1bGVzJC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKHJvb3RVcmw6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcbiAgICAgIHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArICdhcGkvbWUuanNvbicpLnN1YnNjcmliZShcbiAgICAgICAgKHVzZXJJbmZvOiBhbnkpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHVzZXJJbmZvKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9LFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dChudWxsKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfc2FuaXRpemVNZW51SXRlbXMobWVudUl0ZW1zOiBhbnlbXSwgcm9vdFVybDogc3RyaW5nKTogYW55IHtcbiAgICBjb25zdCBzYW5pdGl6ZWRNZW51SXRlbXMgPSBtZW51SXRlbXMubWFwKChpdGVtOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IG5ld0l0ZW06IGFueSA9IHsuLi5pdGVtfTtcbiAgICAgIGlmIChcbiAgICAgICAgIW5ld0l0ZW0uaGFzT3duUHJvcGVydHkoJ2Rpc3BsYXlOYW1lJykgfHxcbiAgICAgICAgbmV3SXRlbS5kaXNwbGF5TmFtZSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBuZXdJdGVtLmRpc3BsYXlOYW1lID0gbmV3SXRlbS5uYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAobmV3SXRlbS5kZWZhdWx0QWN0aW9uLmluZGV4T2YoJ2h0dHAnKSA9PT0gLTEpIHtcbiAgICAgICAgbmV3SXRlbS5kZWZhdWx0QWN0aW9uID0gJy4uLy4uLycgKyBuZXdJdGVtLmRlZmF1bHRBY3Rpb247XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXdJdGVtLmljb24uaW5kZXhPZignaHR0cCcpID09PSAtMSkge1xuICAgICAgICBuZXdJdGVtLmljb24gPSAnLi4vLi4vJyArIG5ld0l0ZW0uaWNvbjtcbiAgICAgIH1cblxuICAgICAgbmV3SXRlbS5vbmx5U2hvd09uU2VhcmNoID0gZmFsc2U7XG5cbiAgICAgIHJldHVybiBuZXdJdGVtO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcHJlZGVmaW5lZE1lbnVJdGVtcyA9IGZyb21Db25zdGFudHMuUFJFREVGSU5FRF9NRU5VX0lURU1TLm1hcChcbiAgICAgIChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgbmV3SXRlbTogYW55ID0gey4uLml0ZW19O1xuXG4gICAgICAgIGlmIChuZXdJdGVtLmRlZmF1bHRBY3Rpb24pIHtcbiAgICAgICAgICBuZXdJdGVtLmRlZmF1bHRBY3Rpb24gPSByb290VXJsICsgbmV3SXRlbS5kZWZhdWx0QWN0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld0l0ZW0uaWNvbikge1xuICAgICAgICAgIG5ld0l0ZW0uaWNvbiA9IHJvb3RVcmwgKyBuZXdJdGVtLmljb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gWy4uLnNhbml0aXplZE1lbnVJdGVtcywgLi4ucHJlZGVmaW5lZE1lbnVJdGVtc107XG4gIH1cbn1cbiJdfQ==