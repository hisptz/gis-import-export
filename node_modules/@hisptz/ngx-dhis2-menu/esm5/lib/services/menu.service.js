/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import * as fromConstants from '../constants';
import { BehaviorSubject, Observable, forkJoin } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
var MenuService = /** @class */ (function () {
    function MenuService(httpClient) {
        this.httpClient = httpClient;
        this._menuModules$ = new BehaviorSubject([]);
    }
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getSystemSettings = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            forkJoin(_this.httpClient.get(rootUrl + 'api/systemSettings.json'), _this.httpClient.get(rootUrl + 'api/system/info.json')).subscribe(function (settings) {
                observer.next(tslib_1.__assign({}, settings[0], settings[1]));
                observer.complete();
            }, function () { return observer.error(null); });
        });
    };
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getMenuModules = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.httpClient.get(rootUrl + 'dhis-web-commons/menu/getModules.action').subscribe(function (menuModuleResult) {
                var /** @type {?} */ sanitizedMenu = _this._sanitizeMenuItems(menuModuleResult.modules, rootUrl);
                _this._menuModules$.next(sanitizedMenu);
                observer.next(sanitizedMenu);
                observer.complete();
            }, function () {
                observer.next(null);
                observer.complete();
            });
        });
    };
    /**
     * @return {?}
     */
    MenuService.prototype.getSanitizedMenus = /**
     * @return {?}
     */
    function () {
        return this._menuModules$.asObservable();
    };
    /**
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype.getUserInfo = /**
     * @param {?} rootUrl
     * @return {?}
     */
    function (rootUrl) {
        var _this = this;
        return Observable.create(function (observer) {
            _this.httpClient.get(rootUrl + 'api/me.json').subscribe(function (userInfo) {
                observer.next(userInfo);
                observer.complete();
            }, function () {
                observer.next(null);
                observer.complete();
            });
        });
    };
    /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    MenuService.prototype._sanitizeMenuItems = /**
     * @param {?} menuItems
     * @param {?} rootUrl
     * @return {?}
     */
    function (menuItems, rootUrl) {
        var /** @type {?} */ sanitizedMenuItems = menuItems.map(function (item) {
            var /** @type {?} */ newItem = tslib_1.__assign({}, item);
            if (!newItem.hasOwnProperty('displayName') ||
                newItem.displayName === '') {
                newItem.displayName = newItem.name;
            }
            if (newItem.defaultAction.indexOf('http') === -1) {
                newItem.defaultAction = '../../' + newItem.defaultAction;
            }
            if (newItem.icon.indexOf('http') === -1) {
                newItem.icon = '../../' + newItem.icon;
            }
            newItem.onlyShowOnSearch = false;
            return newItem;
        });
        var /** @type {?} */ predefinedMenuItems = fromConstants.PREDEFINED_MENU_ITEMS.map(function (item) {
            var /** @type {?} */ newItem = tslib_1.__assign({}, item);
            if (newItem.defaultAction) {
                newItem.defaultAction = rootUrl + newItem.defaultAction;
            }
            if (newItem.icon) {
                newItem.icon = rootUrl + newItem.icon;
            }
            return newItem;
        });
        return tslib_1.__spread(sanitizedMenuItems, predefinedMenuItems);
    };
    MenuService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] },
    ];
    /** @nocollapse */
    MenuService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    /** @nocollapse */ MenuService.ngInjectableDef = i0.defineInjectable({ factory: function MenuService_Factory() { return new MenuService(i0.inject(i1.HttpClient)); }, token: MenuService, providedIn: "root" });
    return MenuService;
}());
export { MenuService };
function MenuService_tsickle_Closure_declarations() {
    /** @type {?} */
    MenuService.prototype._menuModules$;
    /** @type {?} */
    MenuService.prototype.httpClient;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhpc3B0ei9uZ3gtZGhpczItbWVudS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9tZW51LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEtBQUssYUFBYSxNQUFNLGNBQWMsQ0FBQztBQUM5QyxPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxNQUFNLENBQUM7Ozs7SUFNM0QscUJBQW9CLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7NkJBRk0sSUFBSSxlQUFlLENBQVEsRUFBRSxDQUFDO0tBRzdFOzs7OztJQUVELHVDQUFpQjs7OztJQUFqQixVQUFrQixPQUFlO1FBQWpDLGlCQVdDO1FBVkMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsVUFBQSxRQUFRO1lBQy9CLFFBQVEsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcseUJBQXlCLENBQUMsRUFDL0QsS0FBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsT0FBTyxHQUFHLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ2hFLFVBQUMsUUFBZTtnQkFDZCxRQUFRLENBQUMsSUFBSSxzQkFBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ2hELFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNyQixFQUNELGNBQU0sT0FBQSxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFwQixDQUFvQixDQUMzQixDQUFDO1NBQ0gsQ0FBQyxDQUFDO0tBQ0o7Ozs7O0lBRUQsb0NBQWM7Ozs7SUFBZCxV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LGFBQWEsQ0FBQzthQUN6RDtZQUVELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixPQUFPLENBQUMsSUFBSSxHQUFHLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2FBQ3ZDO1lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQztTQUNoQixDQUNGLENBQUM7UUFDRixNQUFNLGtCQUFLLGtCQUFrQixFQUFLLG1CQUFtQixFQUFFOzs7Z0JBL0YxRCxVQUFVLFNBQUMsRUFBQyxVQUFVLEVBQUUsTUFBTSxFQUFDOzs7O2dCQUx2QixVQUFVOzs7c0JBQW5COztTQU1hLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgZnJvbUNvbnN0YW50cyBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xuXG5ASW5qZWN0YWJsZSh7cHJvdmlkZWRJbjogJ3Jvb3QnfSlcbmV4cG9ydCBjbGFzcyBNZW51U2VydmljZSB7XG4gIHByaXZhdGUgX21lbnVNb2R1bGVzJDogQmVoYXZpb3JTdWJqZWN0PGFueVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHtcbiAgfVxuXG4gIGdldFN5c3RlbVNldHRpbmdzKHJvb3RVcmw6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcbiAgICAgIGZvcmtKb2luKHRoaXMuaHR0cENsaWVudC5nZXQocm9vdFVybCArICdhcGkvc3lzdGVtU2V0dGluZ3MuanNvbicpLFxuICAgICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnYXBpL3N5c3RlbS9pbmZvLmpzb24nKSkuc3Vic2NyaWJlKFxuICAgICAgICAoc2V0dGluZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7Li4uc2V0dGluZ3NbMF0sIC4uLnNldHRpbmdzWzFdfSk7XG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4gb2JzZXJ2ZXIuZXJyb3IobnVsbClcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRNZW51TW9kdWxlcyhyb290VXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZShvYnNlcnZlciA9PiB7XG4gICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KHJvb3RVcmwgKyAnZGhpcy13ZWItY29tbW9ucy9tZW51L2dldE1vZHVsZXMuYWN0aW9uJykuc3Vic2NyaWJlKFxuICAgICAgICAobWVudU1vZHVsZVJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3Qgc2FuaXRpemVkTWVudSA9IHRoaXMuX3Nhbml0aXplTWVudUl0ZW1zKG1lbnVNb2R1bGVSZXN1bHQubW9kdWxlcywgcm9vdFVybCk7XG4gICAgICAgICAgdGhpcy5fbWVudU1vZHVsZXMkLm5leHQoc2FuaXRpemVkTWVudSk7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dChcbiAgICAgICAgICAgIHNhbml0aXplZE1lbnVcbiAgICAgICAgICApO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRTYW5pdGl6ZWRNZW51cygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVudU1vZHVsZXMkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8ocm9vdFVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgJ2FwaS9tZS5qc29uJykuc3Vic2NyaWJlKFxuICAgICAgICAodXNlckluZm86IGFueSkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQodXNlckluZm8pO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9zYW5pdGl6ZU1lbnVJdGVtcyhtZW51SXRlbXM6IGFueVtdLCByb290VXJsOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IHNhbml0aXplZE1lbnVJdGVtcyA9IG1lbnVJdGVtcy5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgY29uc3QgbmV3SXRlbTogYW55ID0gey4uLml0ZW19O1xuICAgICAgaWYgKFxuICAgICAgICAhbmV3SXRlbS5oYXNPd25Qcm9wZXJ0eSgnZGlzcGxheU5hbWUnKSB8fFxuICAgICAgICBuZXdJdGVtLmRpc3BsYXlOYW1lID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIG5ld0l0ZW0uZGlzcGxheU5hbWUgPSBuZXdJdGVtLm5hbWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXdJdGVtLmRlZmF1bHRBY3Rpb24uaW5kZXhPZignaHR0cCcpID09PSAtMSkge1xuICAgICAgICBuZXdJdGVtLmRlZmF1bHRBY3Rpb24gPSAnLi4vLi4vJyArIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbjtcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld0l0ZW0uaWNvbi5pbmRleE9mKCdodHRwJykgPT09IC0xKSB7XG4gICAgICAgIG5ld0l0ZW0uaWNvbiA9ICcuLi8uLi8nICsgbmV3SXRlbS5pY29uO1xuICAgICAgfVxuXG4gICAgICBuZXdJdGVtLm9ubHlTaG93T25TZWFyY2ggPSBmYWxzZTtcblxuICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgfSk7XG5cbiAgICBjb25zdCBwcmVkZWZpbmVkTWVudUl0ZW1zID0gZnJvbUNvbnN0YW50cy5QUkVERUZJTkVEX01FTlVfSVRFTVMubWFwKFxuICAgICAgKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBuZXdJdGVtOiBhbnkgPSB7Li4uaXRlbX07XG5cbiAgICAgICAgaWYgKG5ld0l0ZW0uZGVmYXVsdEFjdGlvbikge1xuICAgICAgICAgIG5ld0l0ZW0uZGVmYXVsdEFjdGlvbiA9IHJvb3RVcmwgKyBuZXdJdGVtLmRlZmF1bHRBY3Rpb247XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3SXRlbS5pY29uKSB7XG4gICAgICAgICAgbmV3SXRlbS5pY29uID0gcm9vdFVybCArIG5ld0l0ZW0uaWNvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3SXRlbTtcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBbLi4uc2FuaXRpemVkTWVudUl0ZW1zLCAuLi5wcmVkZWZpbmVkTWVudUl0ZW1zXTtcbiAgfVxufVxuIl19